# 前端组件规范

## 1. 组件分类原则

### 1.1 分类标准

组件按照 **复用程度** 和 **业务耦合度** 两个维度进行分类：

| 分类         | 特征                             | 目录                                                     | 复用范围     |
| ------------ | -------------------------------- | -------------------------------------------------------- | ------------ |
| **基础组件** | 高度复用、通用性强、业务耦合度低 | `src/components/basic/` 或 `src/components/common/`      | 全局复用     |
| **业务组件** | 业务逻辑绑定强、复用性相对较低   | `src/components/business/` 或 `src/components/features/` | 特定业务场景 |

### 1.2 基础组件定义

基础组件是构成应用最小功能单元的通用组件，具有以下特征：

- **无业务属性**：不包含任何业务逻辑，仅处理展示和交互
- **高度复用**：可在多个业务模块中反复使用
- **接口稳定**：对外暴露的 props 和事件需保持向后兼容
- **职责单一**：遵循单一职责原则，每个组件只做好一件事

**示例**：`Button`、`Input`、`Select`、`Modal`、`Table`、`Pagination`

### 1.3 业务组件定义

业务组件是针对具体业务场景设计的复合组件，具有以下特征：

- **业务绑定**：包含特定的业务逻辑和数据处理
- **场景专一**：针对特定业务场景定制
- **组合使用**：由基础组件或其他业务组件组合而成
- **可拆分**：复杂的业务组件应可拆分为更小的可复用单元

**示例**：`UserProfileCard`、`OrderForm`、`ProductGrid`

## 2. 目录结构

### 2.1 组件目录规范

```
src/components/
├── basic/            # 基础组件（原子级）
│   ├── Button.vue               # 按钮组件
│   ├── Input.vue                # 输入框组件
│   ├── Select.vue               # 选择器组件
│   ├── Modal.vue                # 弹窗组件
│   ├── Table.vue                # 表格组件
│   ├── Pagination.vue           # 分页组件
│   ├── Card.vue                 # 卡片组件
│   └── ...
│
├── business/       # 业务组件（复合级）
│   ├── UserCard.vue             # 用户卡片
│   ├── OrderForm.vue            # 订单表单
│   ├── ProductList.vue          # 产品列表
│   └── ...
│
├── index.js                     # 组件全局注册入口（可选）
└── 组件列表文档.md               # 组件清单文档（可选）
```

### 2.2 命名规范

**文件命名**：

- 使用 **PascalCase** 命名法：`Button.vue`、`UserCard.vue`
- 组件名称应清晰表达功能，避免缩写
- 业务组件可包含业务前缀：`User`、`Order`、`Product` 等

**目录命名**：

- 目录名称使用 **小写复数**：`basic`、`business`、`common`、`features`

### 2.3 引用规范

```javascript
// 推荐：使用路径别名
import Button from '@/components/basic/Button.vue'
import UserCard from '@/components/business/UserCard.vue'

// 推荐：使用自动注册（全局）
import { createApp } from 'vue'
import basicComponents from '@/components/basic'

const app = createApp(App)
app.use(basicComponents)
```

## 3. 组件开发规范

### 3.1 文件结构模板

```vue
<template>
  <!-- 模板内容 -->
  <div class="p-4 bg-white rounded-lg shadow">
    <slot></slot>
  </div>
</template>

<script setup>
/**
 * 组件名称
 * 功能描述：简明扼要说明主要功能
 * 遵循原则：KISS（保持简洁）、YAGNI（不会需要）、SOLID
 * Source: 参考的资料或文档来源（可选）
 */

// 1. 导入依赖
import { ref, computed } from 'vue'

// 2. Props 定义
// 3. Emits 定义
// 4. 组件状态
// 5. 计算属性
// 6. 方法定义
</script>

<style scoped>
/**
 * 组件样式
 * 使用 Tailwind CSS 工具类，必要时通过 @apply 提取公共样式
 * 不使用 SCSS 变量和 mixins，改用 Tailwind 配置
 */
</style>
```

### 3.2 Props 定义规范

**方式一：对象语法（推荐）**

```vue
<script setup>
const props = defineProps({
  // 必填属性
  title: {
    type: String,
    required: true
  },
  dataList: {
    type: Array,
    required: true
  },
  
  // 可选属性，提供默认值
  disabled: {
    type: Boolean,
    default: false
  },
  size: {
    type: String,
    default: 'medium',
    validator: (value) => ['small', 'medium', 'large'].includes(value)
  },
  loading: {
    type: Boolean,
    default: false
  },
  
  // 复杂对象类型
  config: {
    type: Object,
    default: () => ({ showIcon: true, maxHeight: 300 })
  }
})
</script>
```

**Props 设计原则**：

- 提供合理的默认值，减少使用时的必需属性
- 使用 validator 进行类型验证
- 保持 props 接口稳定，避免频繁变更

### 3.3 Emits 定义规范

```vue
<script setup>
/**
 * 事件定义
 * 使用 kebab-case 命名
 */
const emit = defineEmits(['update:modelValue', 'change', 'delete', 'submit'])

// 带参数的事件
const emit = defineEmits({
  // 格式：'事件名': (payload) => 验证逻辑
  change: (value) => typeof value === 'string',
  submit: (data) => data !== null
})

/**
 * 触发事件
 */
const handleClick = () => {
  emit('change', newValue)
  emit('update:modelValue', props.modelValue)
}
</script>
```

### 3.4 样式实现规范

**使用 Tailwind CSS 工具类**：

```vue
<template>
  <div class="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg shadow-sm hover:border-primary-500 transition-colors duration-200">
    <span class="text-gray-900 font-medium">{{ title }}</span>
    <button 
      class="px-3 py-1.5 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      :disabled="loading"
      @click="handleAction"
    >
      <span v-if="loading" class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></span>
      {{ loading ? '加载中...' : actionText }}
    </button>
  </div>
</template>

<script setup>
/**
 * 组件样式使用 Tailwind CSS 工具类
 * 响应式设计使用 Tailwind 的响应式前缀
 */
</script>
```

**动态类名处理**：

```vue
<script setup>
import { computed } from 'vue'

const props = defineProps({
  size: { type: String, default: 'medium' }
})

// 推荐：使用计算属性生成动态类名
const containerClasses = computed(() => [
  'custom-container',
  `custom-container--${props.size}`,
  {
    'is-disabled': props.disabled
  }
])
</script>

<template>
  <div :class="containerClasses">
    <slot></slot>
  </div>
</template>
```

### 3.5 禁止的写法

```vue
<!-- 禁止：在组件内部直接操作 DOM 样式 -->
<script setup>
const box = ref(null)
box.value.style.padding = '10px'  // 错误做法
</script>

<!-- 禁止：内联样式 -->
<div style="color: red;">内容</div>

<!-- 禁止：使用未全局注册的组件 -->
<!-- 应在文件中显式导入或配置自动注册 -->
</template>
```

## 4. 基础组件设计规范

### 4.1 设计原则

**KISS 原则（保持简洁）**：

- 只实现实际使用的功能，不做过度设计
- 接口简单直观，降低使用成本
- 代码量控制在合理范围

**YAGNI 原则（你不会需要它）**：

- 不实现未来可能用到的功能
- 按需实现，只满足当前需求
- 避免提前优化

**SOLID 原则**：

- **S**：单一职责，每个组件只做好一件事
- **O**：开放封闭，对扩展开放，对修改封闭
- **L**：里氏替换，可被任意子组件替换
- **I**：接口隔离，暴露最小必要接口
- **D**：依赖倒置，依赖抽象而非具体实现

### 4.2 基础组件示例

```vue
<script setup>
/**
 * Button 组件
 * 功能：统一按钮样式与交互的基础组件
 * 遵循 KISS 原则：简洁实现，只包含必需功能
 * 遵循 YAGNI 原则：只实现实际使用的 props
 * 使用 Tailwind CSS 实现样式
 */
import { computed } from 'vue'

const props = defineProps({
  type: {
    type: String,
    default: 'default'
  },
  size: {
    type: String,
    default: 'md'
  },
  loading: {
    type: Boolean,
    default: false
  },
  disabled: {
    type: Boolean,
    default: false
  },
  block: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits(['click'])

const baseClasses = 'inline-flex items-center justify-center gap-2 font-medium rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2'

const sizeClasses = {
  sm: 'px-3 py-1.5 text-sm',
  md: 'px-4 py-2 text-sm',
  lg: 'px-6 py-3 text-base'
}

const variantClasses = {
  default: 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-400',
  primary: 'border border-transparent bg-primary-600 text-white hover:bg-primary-700',
  success: 'border border-transparent bg-green-600 text-white hover:bg-green-700',
  danger: 'border border-transparent bg-red-600 text-white hover:bg-red-700',
  warning: 'border border-transparent bg-yellow-500 text-white hover:bg-yellow-600'
}

const buttonClasses = computed(() => [
  baseClasses,
  sizeClasses[props.size] || sizeClasses.md,
  variantClasses[props.type] || variantClasses.default,
  {
    'w-full justify-center': props.block,
    'opacity-50 cursor-not-allowed': props.disabled || props.loading
  }
])

const handleClick = (event) => {
  if (!props.loading && !props.disabled) {
    emit('click', event)
  }
}
</script>

<template>
  <button :class="buttonClasses" :disabled="disabled || loading" @click="handleClick">
    <svg v-if="loading" class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    <slot></slot>
  </button>
</template>
```

### 4.3 基础组件职责边界

| 组件   | 职责范围                               |
| ------ | -------------------------------------- |
| Button | 按钮样式、点击事件、加载状态、禁用状态 |
| Input  | 输入框、双向绑定、校验状态             |
| Select | 下拉选择、搜索过滤、多选支持           |
| Modal  | 弹窗显示、遮罩层、关闭处理             |
| Table  | 表格渲染、分页、排序                   |
| Card   | 卡片容器、标题、内容区域               |

## 5. 业务组件设计规范

### 5.1 业务组件特征

业务组件应具备以下特征：

- **业务逻辑清晰**：包含特定业务处理逻辑
- **数据驱动**：响应业务数据变化
- **可测试**：业务逻辑应可独立测试
- **可维护**：代码结构清晰，便于维护

### 5.2 业务组件组合模式

```vue
<script setup>
/**
 * UserCard 组件
 * 功能：用户信息展示卡片
 * 依赖：Button、Avatar 等基础组件
 */
import { ref, watch } from 'vue'
import Button from '@/components/basic/Button.vue'
import Avatar from '@/components/basic/Avatar.vue'

const props = defineProps({
  userId: { type: [String, Number], required: true },
  showActions: { type: Boolean, default: true }
})

const emit = defineEmits(['edit', 'delete', 'view'])

const userInfo = ref(null)
const loading = ref(false)

const loadUserData = async () => {
  loading.value = true
  try {
    const res = await fetchUserInfo(props.userId)
    userInfo.value = res.data
  } finally {
    loading.value = false
  }
}

watch(() => props.userId, () => {
  loadUserData()
}, { immediate: true })

const handleEdit = () => emit('edit', userInfo.value)
const handleDelete = () => emit('delete', props.userId)
</script>
```

### 5.3 业务组件数据流

**单向数据流原则**：

- Props 传入数据，Emits 发出事件
- 内部状态与外部状态分离
- 避免直接修改 props

```vue
<script setup>
const props = defineProps({
  // 只读数据
  data: { type: Object, required: true }
})

const emit = defineEmits(['update', 'delete'])

// 内部状态（不影响外部）
const loading = ref(false)

// 通过事件修改外部数据
const handleUpdate = async () => {
  loading.value = true
  try {
    await saveData(props.data)
    emit('update', props.data)
  } finally {
    loading.value = false
  }
}
</script>
```

## 6. Composables 规范

### 6.1 目录结构

```
src/composables/
├── useForm.js                  # 表单公共逻辑
├── useTable.js                 # 表格公共逻辑
├── useModal.js                 # 弹窗公共逻辑
├── useFetch.js                 # 数据请求公共逻辑
└── useLocalStorage.js          # 本地存储公共逻辑
```

### 6.2 命名规范

- 文件名使用 **camelCase**：`useForm.js`
- 导出的组合式函数名以 **use** 开头：`useForm`

### 6.3 Composables 示例

```javascript
/**
 * 表单公共逻辑 composable
 * 抽取表单验证和提交公共逻辑
 * 
 * Source: Vue 3 官方文档 - Composition API
 */

/**
 * 创建表单的公共状态和方法
 * @param {Object} options - 配置选项
 * @param {Function} options.validateFn - 自定义验证函数
 * @param {Function} options.submitFn - 提交函数
 * @returns {Object} 表单状态和方法
 */
export function useForm(options = {}) {
  const { validateFn = null, submitFn = null } = options

  const formRef = ref(null)
  const loading = ref(false)
  const errors = ref({})

  const form = reactive({
    // 默认空表单，子组件应覆盖此对象
  })

  /**
   * 重置表单到初始状态
   */
  const resetForm = () => {
    errors.value = {}
    formRef.value?.resetFields?.()
  }

  /**
   * 表单验证
   * @returns {Promise<boolean>}
   */
  const validate = async () => {
    if (validateFn) {
      return await validateFn(form)
    }
    return formRef.value?.validate?.() ?? true
  }

  /**
   * 提交表单
   * @param {Object} data - 表单数据
   */
  const handleSubmit = async (data = form) => {
    loading.value = true
    try {
      const valid = await validate()
      if (!valid) return false
    
      if (submitFn) {
        await submitFn(data)
      }
      return true
    } catch (error) {
      console.error('表单提交失败:', error)
      throw error
    } finally {
      loading.value = false
    }
  }

  return {
    formRef,
    form,
    errors,
    loading,
    resetForm,
    validate,
    handleSubmit
  }
}
```

### 6.4 Composables 设计原则

- **职责单一**：每个 composable 只处理一个关注点
- **无状态优先**：优先设计为无状态函数，需要时再添加状态
- **返回接口清晰**：明确返回的状态和方法
- **可组合**：多个 composable 可组合使用

## 7. 组件通信规范

### 7.1 通信方式选择

| 场景                 | 推荐方式         |
| -------------------- | ---------------- |
| 父子组件简单数据传递 | Props / Emits    |
| 跨层级组件通信       | Provide / Inject |
| 全局状态共享         | Pinia / Vuex     |
| 简单事件传递         | mitt（事件总线） |

### 7.2 Provide / Inject 示例

```vue
<!-- 父组件 -->
<script setup>
import { provide, reactive } from 'vue'

const theme = reactive({ color: 'blue', size: 'medium' })
provide('theme', theme)
</script>

<!-- 子组件 -->
<script setup>
import { inject } from 'vue'

const theme = inject('theme')
</script>
```

### 7.3 状态管理（Pinia 示例）

```javascript
// stores/user.js
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useUserStore = defineStore('user', () => {
  const userInfo = ref(null)
  const token = ref(null)

  const setUserInfo = (info) => { userInfo.value = info }
  const setToken = (newToken) => { token.value = newToken }
  const clearUser = () => { 
    userInfo.value = null 
    token.value = null 
  }

  return { userInfo, token, setUserInfo, setToken, clearUser }
})
```

```vue
<!-- 任意组件 -->
<script setup>
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()
userStore.setToken('new-token')
</script>
```

## 8. 组件文档维护

### 8.1 组件清单文档

每个组件目录可维护 `组件列表.md`，记录组件信息：

```markdown
# 组件列表文档

## 基础组件 (basic/)

| 组件名称   | 文件路径           | 功能描述     | 主要依赖 |
| ---------- | ------------------ | ------------ | -------- |
| Button.vue | `basic/Button.vue` | 统一按钮样式 | Vue3     |
| Input.vue  | `basic/Input.vue`  | 输入框组件   | 无       |

## 业务组件 (business/)

| 组件名称     | 文件路径                | 功能描述     | 业务场景 |
| ------------ | ----------------------- | ------------ | -------- |
| UserCard.vue | `business/UserCard.vue` | 用户信息卡片 | 用户管理 |
```

### 8.2 组件内部注释

组件内部关键逻辑需添加中文注释：

```vue
<script setup>
/**
 * 计算按钮样式类名
 * 根据 props.type 和 props.size 动态生成
 */
const buttonClasses = computed(() => {
  return [
    'custom-btn',
    `custom-btn--${props.type}`,
    `custom-btn--${props.size}`
  ]
})

/**
 * 处理点击事件
 * 避免在 loading 或 disabled 状态下触发
 */
const handleClick = (event) => {
  if (!props.loading && !props.disabled) {
    emit('click', event)
  }
}
</script>
```

### 8.3 文档更新要求

- 新增组件后更新组件列表文档
- 删除或重构组件后及时同步文档
- 组件接口变更时更新相关说明

## 9. 性能优化规范

### 9.1 组件懒加载

```javascript
// 路由懒加载
const UserProfile = () => import('@/views/user/Profile.vue')

// 组件懒加载
const Dialog = defineAsyncComponent(() => 
  import('@/components/basic/Dialog.vue')
)
```

### 9.2 v-memo 优化

```vue
<template>
  <div v-memo="[item.id, item.selected]">
    <ComplexComponent :item="item" />
  </div>
</template>
```

### 9.3 避免不必要的响应式

```javascript
// 推荐：不需要响应式的数据使用普通对象
const constants = {
  MAX_SIZE: 100,
  DEFAULT_TIMEOUT: 5000
}

// 避免：大数组整体响应式
const hugeArray = ref(new Array(10000).fill(0))

// 推荐：使用 shallowRef
const hugeArray = shallowRef(new Array(10000).fill(0))
```

## 10. 错误处理规范

### 12.1 边界情况处理

```vue
<script setup>
const props = defineProps({
  data: { type: Array, default: () => [] }
})

const emit = defineEmits(['item-click'])

// 空数据展示
const isEmpty = computed(() => !props.data || props.data.length === 0)
</script>

<template>
  <div class="p-4 bg-white rounded-lg shadow-sm">
    <div v-if="isEmpty" class="flex items-center justify-center py-8 text-gray-500">
      <slot name="empty">
        <span>暂无数据</span>
      </slot>
    </div>
  
    <template v-else>
      <div 
        v-for="item in data" 
        :key="item.id"
        class="p-3 mb-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 transition-colors duration-200"
        @click="emit('item-click', item)"
      >
        <slot :item="item">{{ item.name }}</slot>
      </div>
    </template>
  </div>
</template>
```

### 12.2 异步操作错误处理

```javascript
const handleSubmit = async () => {
  loading.value = true
  error.value = null
  
  try {
    await submitForm(form)
    emit('success')
  } catch (err) {
    error.value = err.message || '操作失败，请重试'
    emit('error', err)
  } finally {
    loading.value = false
  }
}
```


## 11. 图标使用规范

### 11.1 图标库选择

项目统一使用 **FontAwesome** 作为图标库。

### 11.2 使用方式

**基础用法**：

```vue
<template>
  <!-- 直接使用 i 标签 -->
  <i class="fa fa-search"></i>
  <i class="fa fa-user"></i>
  <i class="fa fa-cog"></i>
  
  <!-- 带尺寸 -->
  <i class="fa fa-home fa-lg"></i>
  <i class="fa fa-home fa-2x"></i>
  
  <!-- 带颜色（使用 Tailwind） -->
  <i class="fa fa-heart text-red-500"></i>
  <i class="fa fa-check text-green-600"></i>
</template>
```

**在 Button 组件中使用**：

```vue
<template>
  <!-- 图标按钮 -->
  <Button icon="search" />
  <Button icon="plus" type="primary">新增</Button>
  
  <!-- 圆形图标按钮 -->
  <Button icon="cog" circle />
  <Button icon="edit" circle type="primary" />
</template>
```

### 11.3 常用图标速查

| 图标名称 | 类名 | 用途 |
| -------- | ---- | ---- |
| 搜索 | `fa-search` | 搜索功能 |
| 用户 | `fa-user` | 用户相关 |
| 设置 | `fa-cog` | 设置功能 |
| 编辑 | `fa-edit` | 编辑操作 |
| 删除 | `fa-trash` | 删除操作 |
| 添加 | `fa-plus` | 新增操作 |
| 关闭 | `fa-times` | 关闭/取消 |
| 确认 | `fa-check` | 确认/完成 |
| 刷新 | `fa-refresh` | 刷新操作 |
| 加载 | `fa-spinner fa-spin` | 加载状态 |
| 菜单 | `fa-bars` | 菜单按钮 |
| 箭头 | `fa-angle-left/right/up/down` | 方向指示 |
| 双箭头 | `fa-angle-double-left/right` | 首页/末页 |

### 11.4 图标尺寸

| 类名 | 尺寸 |
| ---- | ---- |
| 默认 | 继承父元素 |
| `fa-lg` | 1.33em |
| `fa-2x` | 2em |
| `fa-3x` | 3em |

### 11.5 注意事项

- 图标名称不包含 `fa-` 前缀传入组件（如 `icon="search"` 而非 `icon="fa-search"`）
- 组件内部会自动添加 `fa fa-` 前缀
- 动画图标使用 `fa-spin` 类（如加载状态）
